------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  c:\ian\git\mvmeta\testlogs\mvmeta_make_cscript.log
  log type:  text
 opened on:  28 Jul 2023, 17:40:20

. 
. version 12

. if c(stata_version)>=13 cls

. cscript adofile mvmeta_make
-------------------------------------------------------------------------BEGIN 

-> which mvmeta_make, usesysdir
c:\ian\git\mvmeta\package\mvmeta_make.ado
*! version 4.1 # Ian White # 27jul2023

. prog drop _all

. set more off

. set trace off

. 
. 
. // VIEW VERSION NUMBERS
. di c(stata_version)
17

. which mvmeta_make
c:\ian\git\mvmeta\package\mvmeta_make.ado
*! version 4.1 # Ian White # 27jul2023

. which mvmeta
c:\ian\git\mvmeta\package\mvmeta.ado
*! version 4.0.2 # Ian White # 21apr2022

. 
. 
. // SIMPLE DATA: COMPARE CLASSIC AND PREFIX SYNTAXES
. use mvmeta_make_testdata_reg, clear

. 
. mvmeta_make reg y x if id>2 [aw=x^2], by(study) saving(z1) mse1 
Learning equation names...
Using coefficients: x 


-> study==1
(sum of wgt is 114.3414036690673)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    230.86
       Model |  230.858319         1  230.858319   Prob > F        =    0.0000
    Residual |  1768.84063        98  18.0493941   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1245
       Total |  1999.69894        97   20.615453   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8290686   .0545654    15.19   0.000     .7207853     .937352
       _cons |   1.658466   .1017512    16.30   0.000     1.456544    1.860388
------------------------------------------------------------------------------


-> study==2
(sum of wgt is 112.1129437378425)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     64.45
       Model |  64.4539471         1  64.4539471   Prob > F        =    0.0000
    Residual |  1802.83582        98  18.3962839   R-squared       =    0.0345
-------------+----------------------------------   Adj R-squared   =    0.0444
       Total |  1867.28977        97    19.25041   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4331591   .0539539     8.03   0.000     .3260894    .5402288
       _cons |   1.623182   .1037183    15.65   0.000     1.417356    1.829007
------------------------------------------------------------------------------


-> study==3
(sum of wgt is 104.6563663529086)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    757.34
       Model |  757.336391         1  757.336391   Prob > F        =    0.0000
    Residual |  2335.55939        98  23.8322386   R-squared       =    0.2449
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  3092.89578        97  31.8855235   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.636802   .0594774    27.52   0.000     1.518771    1.754833
       _cons |   3.316196   .1029054    32.23   0.000     3.111983    3.520408
------------------------------------------------------------------------------

file z1.dta saved

. 
. mvmeta_make, by(study) saving(z2): reg y x if id>2 [aw=x^2], mse1
Learning equation names...
Using coefficients: x 


-> study==1
(sum of wgt is 114.3414036690673)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    230.86
       Model |  230.858319         1  230.858319   Prob > F        =    0.0000
    Residual |  1768.84063        98  18.0493941   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1245
       Total |  1999.69894        97   20.615453   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8290686   .0545654    15.19   0.000     .7207853     .937352
       _cons |   1.658466   .1017512    16.30   0.000     1.456544    1.860388
------------------------------------------------------------------------------


-> study==2
(sum of wgt is 112.1129437378425)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     64.45
       Model |  64.4539471         1  64.4539471   Prob > F        =    0.0000
    Residual |  1802.83582        98  18.3962839   R-squared       =    0.0345
-------------+----------------------------------   Adj R-squared   =    0.0444
       Total |  1867.28977        97    19.25041   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4331591   .0539539     8.03   0.000     .3260894    .5402288
       _cons |   1.623182   .1037183    15.65   0.000     1.417356    1.829007
------------------------------------------------------------------------------


-> study==3
(sum of wgt is 104.6563663529086)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    757.34
       Model |  757.336391         1  757.336391   Prob > F        =    0.0000
    Residual |  2335.55939        98  23.8322386   R-squared       =    0.2449
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  3092.89578        97  31.8855235   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.636802   .0594774    27.52   0.000     1.518771    1.754833
       _cons |   3.316196   .1029054    32.23   0.000     3.111983    3.520408
------------------------------------------------------------------------------

file z2.dta saved

. * check ereturned results without clear
. assert e(sample) == id>2

. assert mi(e(N))

. assert e(cmd)=="mvmeta_make"

. 
. mvmeta_make reg y x if id>2 [aw=x^2], by(study) clear mse1 nodetails
Learning equation names...
Using coefficients: x 
-> study==1
-> study==2
-> study==3
mvmeta_make results are now loaded into memory

. * check ereturned results with clear
. assert e(sample) == 0

. assert mi(e(N))

. assert e(cmd)=="mvmeta_make"

. 
. cf _all using z1

. cf _all using z2

. mvmeta y S
Note: using method reml
Note: using variable yx
Note: 3 observations on 1 variables
Note: variance-covariance matrix is unstructured

initial:       log likelihood = -2.4105811
rescale:       log likelihood = -2.4105811
rescale eq:    log likelihood = -2.4105811
Iteration 0:   log likelihood = -2.4105811  
Iteration 1:   log likelihood = -2.4094909  
Iteration 2:   log likelihood = -2.4094884  
Iteration 3:   log likelihood = -2.4094884  

Multivariate meta-analysis
Variance-covariance matrix = unstructured
Method = reml                                  Number of dimensions    =     1
Restricted log likelihood = -2.4094884         Number of observations  =     3
------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
Overall_mean |
          yx |   .9659791   .3540398     2.73   0.006     .2720738    1.659884
------------------------------------------------------------------------------

Estimated between-studies SDs and correlation matrix
----------------------------------------------------
           SD         yx
yx  .61064753          1
----------------------------------------------------

. 
. 
. // TEST USEVARS ETC
. use mvmeta_make_testdata_reg, clear

. mvmeta_make reg y x if id>2 [aw=x^2], by(study) clear replace mse1 usevars(x)
replace ignored without saving()
Learning equation names...
Using coefficients: x 


-> study==1
(sum of wgt is 114.3414036690673)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    230.86
       Model |  230.858319         1  230.858319   Prob > F        =    0.0000
    Residual |  1768.84063        98  18.0493941   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1245
       Total |  1999.69894        97   20.615453   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8290686   .0545654    15.19   0.000     .7207853     .937352
       _cons |   1.658466   .1017512    16.30   0.000     1.456544    1.860388
------------------------------------------------------------------------------


-> study==2
(sum of wgt is 112.1129437378425)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     64.45
       Model |  64.4539471         1  64.4539471   Prob > F        =    0.0000
    Residual |  1802.83582        98  18.3962839   R-squared       =    0.0345
-------------+----------------------------------   Adj R-squared   =    0.0444
       Total |  1867.28977        97    19.25041   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4331591   .0539539     8.03   0.000     .3260894    .5402288
       _cons |   1.623182   .1037183    15.65   0.000     1.417356    1.829007
------------------------------------------------------------------------------


-> study==3
(sum of wgt is 104.6563663529086)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    757.34
       Model |  757.336391         1  757.336391   Prob > F        =    0.0000
    Residual |  2335.55939        98  23.8322386   R-squared       =    0.2449
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  3092.89578        97  31.8855235   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.636802   .0594774    27.52   0.000     1.518771    1.754833
       _cons |   3.316196   .1029054    32.23   0.000     3.111983    3.520408
------------------------------------------------------------------------------

mvmeta_make results are now loaded into memory

. cf _all using z1

. 
. use mvmeta_make_testdata_reg, clear

. mvmeta_make reg y x if id>2 [aw=x^2], by(study) clear replace mse1 usecoefs(x
> )
replace ignored without saving()
Using coefficients: x 


-> study==1
(sum of wgt is 114.3414036690673)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    230.86
       Model |  230.858319         1  230.858319   Prob > F        =    0.0000
    Residual |  1768.84063        98  18.0493941   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1245
       Total |  1999.69894        97   20.615453   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8290686   .0545654    15.19   0.000     .7207853     .937352
       _cons |   1.658466   .1017512    16.30   0.000     1.456544    1.860388
------------------------------------------------------------------------------


-> study==2
(sum of wgt is 112.1129437378425)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     64.45
       Model |  64.4539471         1  64.4539471   Prob > F        =    0.0000
    Residual |  1802.83582        98  18.3962839   R-squared       =    0.0345
-------------+----------------------------------   Adj R-squared   =    0.0444
       Total |  1867.28977        97    19.25041   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4331591   .0539539     8.03   0.000     .3260894    .5402288
       _cons |   1.623182   .1037183    15.65   0.000     1.417356    1.829007
------------------------------------------------------------------------------


-> study==3
(sum of wgt is 104.6563663529086)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    757.34
       Model |  757.336391         1  757.336391   Prob > F        =    0.0000
    Residual |  2335.55939        98  23.8322386   R-squared       =    0.2449
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  3092.89578        97  31.8855235   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.636802   .0594774    27.52   0.000     1.518771    1.754833
       _cons |   3.316196   .1029054    32.23   0.000     3.111983    3.520408
------------------------------------------------------------------------------

mvmeta_make results are now loaded into memory

. cf _all using z1

. 
. use mvmeta_make_testdata_reg, clear

. mvmeta_make reg y x if id>2 [aw=x^2], by(study) clear replace mse1 usecons
replace ignored without saving()
Learning equation names...
Using coefficients: x _cons 


-> study==1
(sum of wgt is 114.3414036690673)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    230.86
       Model |  230.858319         1  230.858319   Prob > F        =    0.0000
    Residual |  1768.84063        98  18.0493941   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1245
       Total |  1999.69894        97   20.615453   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8290686   .0545654    15.19   0.000     .7207853     .937352
       _cons |   1.658466   .1017512    16.30   0.000     1.456544    1.860388
------------------------------------------------------------------------------


-> study==2
(sum of wgt is 112.1129437378425)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     64.45
       Model |  64.4539471         1  64.4539471   Prob > F        =    0.0000
    Residual |  1802.83582        98  18.3962839   R-squared       =    0.0345
-------------+----------------------------------   Adj R-squared   =    0.0444
       Total |  1867.28977        97    19.25041   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4331591   .0539539     8.03   0.000     .3260894    .5402288
       _cons |   1.623182   .1037183    15.65   0.000     1.417356    1.829007
------------------------------------------------------------------------------


-> study==3
(sum of wgt is 104.6563663529086)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    757.34
       Model |  757.336391         1  757.336391   Prob > F        =    0.0000
    Residual |  2335.55939        98  23.8322386   R-squared       =    0.2449
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  3092.89578        97  31.8855235   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.636802   .0594774    27.52   0.000     1.518771    1.754833
       _cons |   3.316196   .1029054    32.23   0.000     3.111983    3.520408
------------------------------------------------------------------------------

mvmeta_make results are now loaded into memory

. drop y_cons Sx_cons S_cons

. cf _all using z1

. 
. use mvmeta_make_testdata_reg, clear

. count if id>2
  294

. local N = r(N)

. mvmeta_make reg y x if id>2 [aw=x^2], by(study) clear replace mse1 esave(N ll
> )
replace ignored without saving()
Learning equation names...
Using coefficients: x 


-> study==1
(sum of wgt is 114.3414036690673)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    230.86
       Model |  230.858319         1  230.858319   Prob > F        =    0.0000
    Residual |  1768.84063        98  18.0493941   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1245
       Total |  1999.69894        97   20.615453   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .8290686   .0545654    15.19   0.000     .7207853     .937352
       _cons |   1.658466   .1017512    16.30   0.000     1.456544    1.860388
------------------------------------------------------------------------------


-> study==2
(sum of wgt is 112.1129437378425)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     64.45
       Model |  64.4539471         1  64.4539471   Prob > F        =    0.0000
    Residual |  1802.83582        98  18.3962839   R-squared       =    0.0345
-------------+----------------------------------   Adj R-squared   =    0.0444
       Total |  1867.28977        97    19.25041   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4331591   .0539539     8.03   0.000     .3260894    .5402288
       _cons |   1.623182   .1037183    15.65   0.000     1.417356    1.829007
------------------------------------------------------------------------------


-> study==3
(sum of wgt is 104.6563663529086)

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    757.34
       Model |  757.336391         1  757.336391   Prob > F        =    0.0000
    Residual |  2335.55939        98  23.8322386   R-squared       =    0.2449
-------------+----------------------------------   Adj R-squared   =    0.2526
       Total |  3092.89578        97  31.8855235   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.636802   .0594774    27.52   0.000     1.518771    1.754833
       _cons |   3.316196   .1029054    32.23   0.000     3.111983    3.520408
------------------------------------------------------------------------------

mvmeta_make results are now loaded into memory

. sum _e_N, meanonly

. assert r(sum)==`N'

. drop _e_N _e_ll

. cf _all using z1

. 
. 
. // TEST WITH MULTIPLE EQUATIONS
. use mvmeta_make_testdata_reg, clear

. mvmeta_make mlogit yg x if id>2, by(study) saving(z3) replace baseoutcome(0)
Learning equation names...
Using coefficients: [1]x [2]x 
(file z3.dta not found)


-> study==1

Iteration 0:   log likelihood = -107.16772  
Iteration 1:   log likelihood =  -100.9551  
Iteration 2:   log likelihood = -100.87809  
Iteration 3:   log likelihood = -100.87805  
Iteration 4:   log likelihood = -100.87805  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =  12.58
                                                        Prob > chi2   = 0.0019
Log likelihood = -100.87805                             Pseudo R2     = 0.0587

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |    .868878    .277198     3.13   0.002     .3255798    1.412176
       _cons |  -.2502625    .271354    -0.92   0.356    -.7821066    .2815815
-------------+----------------------------------------------------------------
2            |
           x |   .5669772   .2502534     2.27   0.023     .0764896    1.057465
       _cons |  -.0626956   .2530652    -0.25   0.804    -.5586942    .4333031
------------------------------------------------------------------------------


-> study==2

Iteration 0:   log likelihood =  -107.5922  
Iteration 1:   log likelihood = -106.24798  
Iteration 2:   log likelihood = -106.24254  
Iteration 3:   log likelihood = -106.24254  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =   2.70
                                                        Prob > chi2   = 0.2593
Log likelihood = -106.24254                             Pseudo R2     = 0.0125

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |    .358651   .2397809     1.50   0.135    -.1113109    .8286128
       _cons |   .0037561   .2491483     0.02   0.988    -.4845655    .4920778
-------------+----------------------------------------------------------------
2            |
           x |   .3120172    .243982     1.28   0.201    -.1661788    .7902132
       _cons |  -.0772502   .2537175    -0.30   0.761    -.5745275     .420027
------------------------------------------------------------------------------


-> study==3

Iteration 0:   log likelihood = -103.10899  
Iteration 1:   log likelihood = -101.90941  
Iteration 2:   log likelihood = -101.90543  
Iteration 3:   log likelihood = -101.90542  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =   2.41
                                                        Prob > chi2   = 0.3001
Log likelihood = -101.90542                             Pseudo R2     = 0.0117

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |   .1640967   .2680008     0.61   0.540    -.3611752    .6893685
       _cons |  -.1068007   .2820292    -0.38   0.705    -.6595678    .4459664
-------------+----------------------------------------------------------------
2            |
           x |   .3607672   .2380306     1.52   0.130    -.1057643    .8272987
       _cons |   .5408983   .2454038     2.20   0.028     .0599157    1.021881
------------------------------------------------------------------------------

file z3.dta saved

. mvmeta_make mlogit yg x if id>2, by(study) saving(z4) replace baseoutcome(0) 
> usecoefs([1]x [2]x)
Using coefficients: [1]x [2]x 
(file z4.dta not found)


-> study==1

Iteration 0:   log likelihood = -107.16772  
Iteration 1:   log likelihood =  -100.9551  
Iteration 2:   log likelihood = -100.87809  
Iteration 3:   log likelihood = -100.87805  
Iteration 4:   log likelihood = -100.87805  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =  12.58
                                                        Prob > chi2   = 0.0019
Log likelihood = -100.87805                             Pseudo R2     = 0.0587

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |    .868878    .277198     3.13   0.002     .3255798    1.412176
       _cons |  -.2502625    .271354    -0.92   0.356    -.7821066    .2815815
-------------+----------------------------------------------------------------
2            |
           x |   .5669772   .2502534     2.27   0.023     .0764896    1.057465
       _cons |  -.0626956   .2530652    -0.25   0.804    -.5586942    .4333031
------------------------------------------------------------------------------


-> study==2

Iteration 0:   log likelihood =  -107.5922  
Iteration 1:   log likelihood = -106.24798  
Iteration 2:   log likelihood = -106.24254  
Iteration 3:   log likelihood = -106.24254  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =   2.70
                                                        Prob > chi2   = 0.2593
Log likelihood = -106.24254                             Pseudo R2     = 0.0125

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |    .358651   .2397809     1.50   0.135    -.1113109    .8286128
       _cons |   .0037561   .2491483     0.02   0.988    -.4845655    .4920778
-------------+----------------------------------------------------------------
2            |
           x |   .3120172    .243982     1.28   0.201    -.1661788    .7902132
       _cons |  -.0772502   .2537175    -0.30   0.761    -.5745275     .420027
------------------------------------------------------------------------------


-> study==3

Iteration 0:   log likelihood = -103.10899  
Iteration 1:   log likelihood = -101.90941  
Iteration 2:   log likelihood = -101.90543  
Iteration 3:   log likelihood = -101.90542  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =   2.41
                                                        Prob > chi2   = 0.3001
Log likelihood = -101.90542                             Pseudo R2     = 0.0117

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |   .1640967   .2680008     0.61   0.540    -.3611752    .6893685
       _cons |  -.1068007   .2820292    -0.38   0.705    -.6595678    .4459664
-------------+----------------------------------------------------------------
2            |
           x |   .3607672   .2380306     1.52   0.130    -.1057643    .8272987
       _cons |   .5408983   .2454038     2.20   0.028     .0599157    1.021881
------------------------------------------------------------------------------

file z4.dta saved

. mvmeta_make mlogit yg x if id>2, by(study) saving(z5) replace baseoutcome(0) 
> usecoefs([1]x [2]x [2]_cons)
Using coefficients: [1]x [2]x [2]_cons 
(file z5.dta not found)


-> study==1

Iteration 0:   log likelihood = -107.16772  
Iteration 1:   log likelihood =  -100.9551  
Iteration 2:   log likelihood = -100.87809  
Iteration 3:   log likelihood = -100.87805  
Iteration 4:   log likelihood = -100.87805  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =  12.58
                                                        Prob > chi2   = 0.0019
Log likelihood = -100.87805                             Pseudo R2     = 0.0587

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |    .868878    .277198     3.13   0.002     .3255798    1.412176
       _cons |  -.2502625    .271354    -0.92   0.356    -.7821066    .2815815
-------------+----------------------------------------------------------------
2            |
           x |   .5669772   .2502534     2.27   0.023     .0764896    1.057465
       _cons |  -.0626956   .2530652    -0.25   0.804    -.5586942    .4333031
------------------------------------------------------------------------------


-> study==2

Iteration 0:   log likelihood =  -107.5922  
Iteration 1:   log likelihood = -106.24798  
Iteration 2:   log likelihood = -106.24254  
Iteration 3:   log likelihood = -106.24254  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =   2.70
                                                        Prob > chi2   = 0.2593
Log likelihood = -106.24254                             Pseudo R2     = 0.0125

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |    .358651   .2397809     1.50   0.135    -.1113109    .8286128
       _cons |   .0037561   .2491483     0.02   0.988    -.4845655    .4920778
-------------+----------------------------------------------------------------
2            |
           x |   .3120172    .243982     1.28   0.201    -.1661788    .7902132
       _cons |  -.0772502   .2537175    -0.30   0.761    -.5745275     .420027
------------------------------------------------------------------------------


-> study==3

Iteration 0:   log likelihood = -103.10899  
Iteration 1:   log likelihood = -101.90941  
Iteration 2:   log likelihood = -101.90543  
Iteration 3:   log likelihood = -101.90542  

Multinomial logistic regression                         Number of obs =     98
                                                        LR chi2(2)    =   2.41
                                                        Prob > chi2   = 0.3001
Log likelihood = -101.90542                             Pseudo R2     = 0.0117

------------------------------------------------------------------------------
          yg | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
0            |  (base outcome)
-------------+----------------------------------------------------------------
1            |
           x |   .1640967   .2680008     0.61   0.540    -.3611752    .6893685
       _cons |  -.1068007   .2820292    -0.38   0.705    -.6595678    .4459664
-------------+----------------------------------------------------------------
2            |
           x |   .3607672   .2380306     1.52   0.130    -.1057643    .8272987
       _cons |   .5408983   .2454038     2.20   0.028     .0599157    1.021881
------------------------------------------------------------------------------

file z5.dta saved

. 
. use z4, clear

. cf _all using z3

. 
. use z5, clear

. drop y2_cons S1x2_cons S2x2_cons S2_cons2_cons

. cf _all using z3

. 
. 
. // MI DATA: CHECK COMPLEX PREFIX SYNTAX & AGREEMENT WITH SIMPLE ANALYSIS
. 
. use mvmeta_make_testdata_mi, clear

. 
. mi estimate, post: reg y x if id>2 & study==1, robust coefl

Multiple-imputation estimates                   Imputations       =          3
Linear regression                               Number of obs     =         48
                                                Average RVI       =     0.0605
                                                Largest FMI       =     0.0796
                                                Complete DF       =         46
DF adjustment:   Small sample                   DF:     min       =      37.16
                                                        avg       =      39.49
                                                        max       =      41.81
Model F test:       Equal FMI                   F(   1,   37.2)   =       2.97
Within VCE type:       Robust                   Prob > F          =     0.0931

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.474819   .8556717     1.72   0.093    -.2586777    3.208315
       _cons |   1.757649   .7051929     2.49   0.017     .3343188    3.180979
------------------------------------------------------------------------------

. local varx=_se[x]^2

. 
. cap noi mvmeta_make, by(study) clear cons: mi estimate, post: reg y x, robust
>  coefl
option cons not allowed

. * error: option cons not allowed
. 
. mvmeta_make, by(study) clear usecons details: mi estimate, post: reg y x if i
> d>2, robust coefl
Robust standard error requested - ppfix set to none
Learning equation names...
Using coefficients: x _cons 


-> study==1

Multiple-imputation estimates                   Imputations       =          3
Linear regression                               Number of obs     =         48
                                                Average RVI       =     0.0605
                                                Largest FMI       =     0.0755
                                                Complete DF       =         46
DF adjustment:   Small sample                   DF:     min       =      37.16
                                                        avg       =      39.49
                                                        max       =      41.81
Model F test:       Equal FMI                   F(   1,   37.2)   =       2.97
Within VCE type:       Robust                   Prob > F          =     0.0931

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.474819   .8556717     1.72   0.093    -.2586777    3.208315
       _cons |   1.757649   .7051929     2.49   0.017     .3343188    3.180979
------------------------------------------------------------------------------


-> study==2

Multiple-imputation estimates                   Imputations       =          3
Linear regression                               Number of obs     =         98
                                                Average RVI       =     0.1754
                                                Largest FMI       =     0.3047
                                                Complete DF       =         96
DF adjustment:   Small sample                   DF:     min       =      20.83
                                                        avg       =      57.40
                                                        max       =      93.97
Model F test:       Equal FMI                   F(   1,   20.8)   =       5.42
Within VCE type:       Robust                   Prob > F          =     0.0300

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.312209   .5635275     2.33   0.030     .1396986     2.48472
       _cons |    1.28925   .4702808     2.74   0.007     .3554925    2.223007
------------------------------------------------------------------------------


-> study==3

Multiple-imputation estimates                   Imputations       =          3
Linear regression                               Number of obs     =        148
                                                Average RVI       =     0.0176
                                                Largest FMI       =     0.0338
                                                Complete DF       =        146
DF adjustment:   Small sample                   DF:     min       =     129.64
                                                        avg       =     136.83
                                                        max       =     144.02
Model F test:       Equal FMI                   F(   1,  129.6)   =       6.67
Within VCE type:       Robust                   Prob > F          =     0.0109

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.162395   .4499299     2.58   0.011     .2722394     2.05255
       _cons |   2.586986   .3834443     6.75   0.000      1.82908    3.344891
------------------------------------------------------------------------------

mvmeta_make results are now loaded into memory

. assert reldif(Sxx[1],`varx') < 1E-7

. 
. 
. // MIXED MODEL: CHECK COMPLEX PREFIX SYNTAX
. * mixed was new in Stata 13
. if c(stata_version)>=13 {
.         use mvmeta_make_testdata_mixed, clear
.         gen x1=x*(time==1)
.         gen x2=x*(time==2)
.         mixed y time x1 x2 if id>2 & study==1 || id:, reml

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log restricted-likelihood = -584.10262  
Iteration 1:   log restricted-likelihood = -583.57789  
Iteration 2:   log restricted-likelihood = -583.57787  

Computing standard errors:

Mixed-effects REML regression                   Number of obs     =        196
Group variable: id                              Number of groups  =         98
                                                Obs per group:
                                                              min =          2
                                                              avg =        2.0
                                                              max =          2
                                                Wald chi2(3)      =      18.03
Log restricted-likelihood = -583.57787          Prob > chi2       =     0.0004

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        time |    .350878   .6714289     0.52   0.601    -.9650984    1.666854
          x1 |   .9844747   .4506773     2.18   0.029     .1011634    1.867786
          x2 |   1.669802   .4506773     3.71   0.000     .7864905    2.553113
       _cons |   1.206577   1.067058     1.13   0.258    -.8848172    3.297972
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
id: Identity                 |
                  var(_cons) |   1.133804   2.372819      .0187563    68.53755
-----------------------------+------------------------------------------------
               var(Residual) |    22.0888   3.188135      16.64624    29.31085
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 0.23          Prob >= chibar2 = 0.3161
.         local varx1=_se[x1]^2
.         mvmeta_make, by(study) clear: mixed y time x1 x2 if id>2 || id:, reml
Learning equation names...
Using coefficients: time x1 x2 


-> study==1

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log restricted-likelihood = -584.10262  
Iteration 1:   log restricted-likelihood = -583.57789  
Iteration 2:   log restricted-likelihood = -583.57787  

Computing standard errors:

Mixed-effects REML regression                   Number of obs     =        196
Group variable: id                              Number of groups  =         98
                                                Obs per group:
                                                              min =          2
                                                              avg =        2.0
                                                              max =          2
                                                Wald chi2(3)      =      18.03
Log restricted-likelihood = -583.57787          Prob > chi2       =     0.0004

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        time |    .350878   .6714289     0.52   0.601    -.9650984    1.666854
          x1 |   .9844747   .4506773     2.18   0.029     .1011634    1.867786
          x2 |   1.669802   .4506773     3.71   0.000     .7864905    2.553113
       _cons |   1.206577   1.067058     1.13   0.258    -.8848172    3.297972
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
id: Identity                 |
                  var(_cons) |   1.133804   2.372819      .0187563    68.53755
-----------------------------+------------------------------------------------
               var(Residual) |    22.0888   3.188135      16.64624    29.31085
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 0.23          Prob >= chibar2 = 0.3161


-> study==2

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log restricted-likelihood = -581.56748  
Iteration 1:   log restricted-likelihood = -581.36112  
Iteration 2:   log restricted-likelihood = -581.36112  

Computing standard errors:

Mixed-effects REML regression                   Number of obs     =        196
Group variable: id                              Number of groups  =         98
                                                Obs per group:
                                                              min =          2
                                                              avg =        2.0
                                                              max =          2
                                                Wald chi2(3)      =       5.92
Log restricted-likelihood = -581.36112          Prob > chi2       =     0.1153

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        time |  -.7524942   .6419033    -1.17   0.241    -2.010602    .5056132
          x1 |   .4109909   .4545043     0.90   0.366    -.4798211    1.301803
          x2 |   .9480432   .4545043     2.09   0.037     .0572311    1.838855
       _cons |   2.825754   1.029759     2.74   0.006     .8074646    4.844044
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
id: Identity                 |
                  var(_cons) |     2.9315   2.352427      .6081773    14.13024
-----------------------------+------------------------------------------------
               var(Residual) |   19.93037   2.876696      15.01949    26.44695
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 1.59          Prob >= chibar2 = 0.1036


-> study==3

Performing EM optimization: 

Performing gradient-based optimization: 

Iteration 0:   log restricted-likelihood = -593.71796  
Iteration 1:   log restricted-likelihood = -592.65551  
Iteration 2:   log restricted-likelihood = -592.65441  
Iteration 3:   log restricted-likelihood = -592.65441  

Computing standard errors:

Mixed-effects REML regression                   Number of obs     =        196
Group variable: id                              Number of groups  =         98
                                                Obs per group:
                                                              min =          2
                                                              avg =        2.0
                                                              max =          2
                                                Wald chi2(3)      =      12.29
Log restricted-likelihood = -592.65441          Prob > chi2       =     0.0064

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
        time |   .0921811   .7232439     0.13   0.899    -1.325351    1.509713
          x1 |   1.485578   .4948801     3.00   0.003     .5156309    2.455525
          x2 |    .896015   .4948801     1.81   0.070    -.0739322    1.865962
       _cons |   3.196704   1.143549     2.80   0.005     .9553892    5.438019
------------------------------------------------------------------------------

------------------------------------------------------------------------------
  Random-effects parameters  |   Estimate   Std. err.     [95% conf. interval]
-----------------------------+------------------------------------------------
id: Identity                 |
                  var(_cons) |   3.13e-13   1.52e-12      2.26e-17    4.34e-09
-----------------------------+------------------------------------------------
               var(Residual) |   25.51961   2.604584      20.89289     31.1709
------------------------------------------------------------------------------
LR test vs. linear model: chibar2(01) = 2.3e-13       Prob >= chibar2 = 1.0000

mvmeta_make results are now loaded into memory
.         assert reldif(Sx1x1[1],`varx1') < 1E-7
. }

. 
. 
. // TWO BYVARS
. use mvmeta_make_testdata_mixed, clear

. reg y x if id>2 & study==1 & time==1, mse1

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    110.81
       Model |  110.812499         1  110.812499   Prob > F        =    0.0000
    Residual |   2225.4775        98  22.7089541   R-squared       =    0.0474
-------------+----------------------------------   Adj R-squared   =    0.0572
       Total |     2336.29        97   24.085464   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .9844747   .0935212    10.53   0.000     .7988849    1.170065
       _cons |   1.557455    .101018    15.42   0.000     1.356988    1.757922
------------------------------------------------------------------------------

. local varx=_se[x]^2

. mvmeta_make, by(study time) clear saving(c:\temp\z): reg y x if id>2, mse1
Learning equation names...
Using coefficients: x 


-> study==1 time==1

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    110.81
       Model |  110.812499         1  110.812499   Prob > F        =    0.0000
    Residual |   2225.4775        98  22.7089541   R-squared       =    0.0474
-------------+----------------------------------   Adj R-squared   =    0.0572
       Total |     2336.29        97   24.085464   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .9844747   .0935212    10.53   0.000     .7988849    1.170065
       _cons |   1.557455    .101018    15.42   0.000     1.356988    1.757922
------------------------------------------------------------------------------


-> study==1 time==2

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    318.79
       Model |  318.793505         1  318.793505   Prob > F        =    0.0000
    Residual |  2233.26209        98  22.7883887   R-squared       =    0.1249
-------------+----------------------------------   Adj R-squared   =    0.1338
       Total |  2552.05559        97  26.3098515   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.669802   .0935212    17.85   0.000     1.484212    1.855392
       _cons |   1.908333    .101018    18.89   0.000     1.707866      2.1088
------------------------------------------------------------------------------


-> study==2 time==1

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     18.69
       Model |  18.6939132         1  18.6939132   Prob > F        =    0.0000
    Residual |  2529.96511        98  25.8159705   R-squared       =    0.0073
-------------+----------------------------------   Adj R-squared   =    0.0175
       Total |  2548.65902        97  26.2748353   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .4109909   .0950566     4.32   0.000     .2223543    .5996276
       _cons |    2.07326    .101671    20.39   0.000     1.871497    2.275023
------------------------------------------------------------------------------


-> study==2 time==2

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     99.47
       Model |  99.4699709         1  99.4699709   Prob > F        =    0.0000
    Residual |  1859.51392        98  18.9746318   R-squared       =    0.0508
-------------+----------------------------------   Adj R-squared   =    0.0605
       Total |  1958.98389        97  20.1957102   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   .9480432   .0950566     9.97   0.000     .7594065     1.13668
       _cons |   1.320766    .101671    12.99   0.000     1.119003    1.522529
------------------------------------------------------------------------------


-> study==3 time==1

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =    229.97
       Model |  229.966697         1  229.966697   Prob > F        =    0.0000
    Residual |  2400.20802        98  24.4919186   R-squared       =    0.0874
-------------+----------------------------------   Adj R-squared   =    0.0967
       Total |  2630.17472        97  27.1152033   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |   1.485578   .0979632    15.16   0.000     1.291173    1.679983
       _cons |   3.288885   .1012355    32.49   0.000     3.087987    3.489784
------------------------------------------------------------------------------


-> study==3 time==2

      Source |       SS           df       MS      Number of obs   =        98
-------------+----------------------------------   F(1, 98)        =     83.66
       Model |  83.6574289         1  83.6574289   Prob > F        =    0.0000
    Residual |  2499.55632        98  25.5056767   R-squared       =    0.0324
-------------+----------------------------------   Adj R-squared   =    0.0423
       Total |  2583.21375        97  26.6310696   Root MSE        =         1

------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
           x |    .896015   .0979632     9.15   0.000     .7016102     1.09042
       _cons |   3.381066   .1012355    33.40   0.000     3.180168    3.581965
------------------------------------------------------------------------------

file c:\temp\z.dta saved
mvmeta_make results are also loaded into memory

. assert reldif(Sxx[1],`varx') < 1E-7

. 
. 
. // SURVIVAL DATA
. use mvmeta_make_testdata_surv, clear

. stcox z x if id>2 & study==3

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -132.76835
Iteration 1:   log likelihood = -116.83722
Iteration 2:   log likelihood =  -116.5633
Iteration 3:   log likelihood = -116.56305
Refining estimates:
Iteration 0:   log likelihood = -116.56305

Cox regression with no ties

No. of subjects =       88                              Number of obs =     88
No. of failures =       31
Time at risk    = 352.2293
                                                        LR chi2(2)    =  32.41
Log likelihood = -116.56305                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   .6057774   .2203167    -1.38   0.168      .296987    1.235631
           x |   2.997061   .6393693     5.15   0.000     1.972908    4.552858
------------------------------------------------------------------------------

. local se1 = _se[x]

. count if id>2 & study==3
  88

. local n = r(N)

. count if id>2 & study==3 & _d
  31

. local d = r(N)

. count if id>2 & z==0 & study==3
  38

. local n0 = r(N)

. count if id>2 & z==0 & study==3 & _d
  17

. local d0 = r(N)

. sum _t if id>2 & z==0 & study==3, meanonly

. local py0 = r(sum)

. mvmeta_make stcox z x if id>2, by(study) saving(z1) replace 
Learning equation names...
Using coefficients: z x 


-> study==3

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -132.76835
Iteration 1:   log likelihood = -116.83722
Iteration 2:   log likelihood =  -116.5633
Iteration 3:   log likelihood = -116.56305
Refining estimates:
Iteration 0:   log likelihood = -116.56305

Cox regression with no ties

No. of subjects =       88                              Number of obs =     88
No. of failures =       31
Time at risk    = 352.2293
                                                        LR chi2(2)    =  32.41
Log likelihood = -116.56305                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   .6057774   .2203167    -1.38   0.168      .296987    1.235631
           x |   2.997061   .6393693     5.15   0.000     1.972908    4.552858
------------------------------------------------------------------------------


-> study==4

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -165.91091
Iteration 1:   log likelihood = -141.55233
Iteration 2:   log likelihood = -141.45989
Iteration 3:   log likelihood = -141.45984
Refining estimates:
Iteration 0:   log likelihood = -141.45984

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       38
Time at risk    = 387.9554
                                                        LR chi2(2)    =  48.90
Log likelihood = -141.45984                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   2.491136   .9104403     2.50   0.013     1.217047    5.099032
           x |   3.199794   .5742794     6.48   0.000     2.250887    4.548733
------------------------------------------------------------------------------


-> study==5

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -178.14324
Iteration 1:   log likelihood = -163.51634
Iteration 2:   log likelihood = -162.61211
Iteration 3:   log likelihood = -162.60463
Iteration 4:   log likelihood = -162.60463
Refining estimates:
Iteration 0:   log likelihood = -162.60463

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       41
Time at risk    = 367.7274
                                                        LR chi2(2)    =  31.08
Log likelihood = -162.60463                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   1.327438   .4234037     0.89   0.375      .710415    2.480367
           x |   2.880458   .6444758     4.73   0.000      1.85786     4.46591
------------------------------------------------------------------------------

file z1.dta saved

. mvmeta_make, by(study) saving(z2) replace : stcox z x if id>2
Learning equation names...
Using coefficients: z x 


-> study==3

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -132.76835
Iteration 1:   log likelihood = -116.83722
Iteration 2:   log likelihood =  -116.5633
Iteration 3:   log likelihood = -116.56305
Refining estimates:
Iteration 0:   log likelihood = -116.56305

Cox regression with no ties

No. of subjects =       88                              Number of obs =     88
No. of failures =       31
Time at risk    = 352.2293
                                                        LR chi2(2)    =  32.41
Log likelihood = -116.56305                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   .6057774   .2203167    -1.38   0.168      .296987    1.235631
           x |   2.997061   .6393693     5.15   0.000     1.972908    4.552858
------------------------------------------------------------------------------


-> study==4

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -165.91091
Iteration 1:   log likelihood = -141.55233
Iteration 2:   log likelihood = -141.45989
Iteration 3:   log likelihood = -141.45984
Refining estimates:
Iteration 0:   log likelihood = -141.45984

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       38
Time at risk    = 387.9554
                                                        LR chi2(2)    =  48.90
Log likelihood = -141.45984                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   2.491136   .9104403     2.50   0.013     1.217047    5.099032
           x |   3.199794   .5742794     6.48   0.000     2.250887    4.548733
------------------------------------------------------------------------------


-> study==5

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -178.14324
Iteration 1:   log likelihood = -163.51634
Iteration 2:   log likelihood = -162.61211
Iteration 3:   log likelihood = -162.60463
Iteration 4:   log likelihood = -162.60463
Refining estimates:
Iteration 0:   log likelihood = -162.60463

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       41
Time at risk    = 367.7274
                                                        LR chi2(2)    =  31.08
Log likelihood = -162.60463                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   1.327438   .4234037     0.89   0.375      .710415    2.480367
           x |   2.880458   .6444758     4.73   0.000      1.85786     4.46591
------------------------------------------------------------------------------

file z2.dta saved

. mvmeta_make, by(study) saving(z3) replace countby(z): stcox z x if id>2
Learning equation names...
Using coefficients: z x 


-> study==3

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -132.76835
Iteration 1:   log likelihood = -116.83722
Iteration 2:   log likelihood =  -116.5633
Iteration 3:   log likelihood = -116.56305
Refining estimates:
Iteration 0:   log likelihood = -116.56305

Cox regression with no ties

No. of subjects =       88                              Number of obs =     88
No. of failures =       31
Time at risk    = 352.2293
                                                        LR chi2(2)    =  32.41
Log likelihood = -116.56305                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   .6057774   .2203167    -1.38   0.168      .296987    1.235631
           x |   2.997061   .6393693     5.15   0.000     1.972908    4.552858
------------------------------------------------------------------------------


-> study==4

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -165.91091
Iteration 1:   log likelihood = -141.55233
Iteration 2:   log likelihood = -141.45989
Iteration 3:   log likelihood = -141.45984
Refining estimates:
Iteration 0:   log likelihood = -141.45984

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       38
Time at risk    = 387.9554
                                                        LR chi2(2)    =  48.90
Log likelihood = -141.45984                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   2.491136   .9104403     2.50   0.013     1.217047    5.099032
           x |   3.199794   .5742794     6.48   0.000     2.250887    4.548733
------------------------------------------------------------------------------


-> study==5

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -178.14324
Iteration 1:   log likelihood = -163.51634
Iteration 2:   log likelihood = -162.61211
Iteration 3:   log likelihood = -162.60463
Iteration 4:   log likelihood = -162.60463
Refining estimates:
Iteration 0:   log likelihood = -162.60463

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       41
Time at risk    = 367.7274
                                                        LR chi2(2)    =  31.08
Log likelihood = -162.60463                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   1.327438   .4234037     0.89   0.375      .710415    2.480367
           x |   2.880458   .6444758     4.73   0.000      1.85786     4.46591
------------------------------------------------------------------------------

file z3.dta saved

. mvmeta_make, by(study) saving(z4) replace counts(r s f): stcox z x if id>2
Learning equation names...
Using coefficients: z x 


-> study==3

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -132.76835
Iteration 1:   log likelihood = -116.83722
Iteration 2:   log likelihood =  -116.5633
Iteration 3:   log likelihood = -116.56305
Refining estimates:
Iteration 0:   log likelihood = -116.56305

Cox regression with no ties

No. of subjects =       88                              Number of obs =     88
No. of failures =       31
Time at risk    = 352.2293
                                                        LR chi2(2)    =  32.41
Log likelihood = -116.56305                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   .6057774   .2203167    -1.38   0.168      .296987    1.235631
           x |   2.997061   .6393693     5.15   0.000     1.972908    4.552858
------------------------------------------------------------------------------


-> study==4

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -165.91091
Iteration 1:   log likelihood = -141.55233
Iteration 2:   log likelihood = -141.45989
Iteration 3:   log likelihood = -141.45984
Refining estimates:
Iteration 0:   log likelihood = -141.45984

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       38
Time at risk    = 387.9554
                                                        LR chi2(2)    =  48.90
Log likelihood = -141.45984                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   2.491136   .9104403     2.50   0.013     1.217047    5.099032
           x |   3.199794   .5742794     6.48   0.000     2.250887    4.548733
------------------------------------------------------------------------------


-> study==5

        Failure _d: d
  Analysis time _t: t

Iteration 0:   log likelihood = -178.14324
Iteration 1:   log likelihood = -163.51634
Iteration 2:   log likelihood = -162.61211
Iteration 3:   log likelihood = -162.60463
Iteration 4:   log likelihood = -162.60463
Refining estimates:
Iteration 0:   log likelihood = -162.60463

Cox regression with no ties

No. of subjects =       98                              Number of obs =     98
No. of failures =       41
Time at risk    = 367.7274
                                                        LR chi2(2)    =  31.08
Log likelihood = -162.60463                             Prob > chi2   = 0.0000

------------------------------------------------------------------------------
          _t | Haz. ratio   Std. err.      z    P>|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
           z |   1.327438   .4234037     0.89   0.375      .710415    2.480367
           x |   2.880458   .6444758     4.73   0.000      1.85786     4.46591
------------------------------------------------------------------------------

file z4.dta saved

. 
. use z3, clear

. * compare with direct calculations
. assert ns_z_0==`n0' if study==3

. assert nf_z_0==`d0' if study==3

. assert reldif(pt_z_0,`py0')<1E-7 if study==3

. assert reldif(Sxx, `se1'^2)<1E-7 if study==3

. * compare with other mvmeta_make commands
. drop ns_z_0 nf_z_0 pt_z_0 ns_z_1 nf_z_1 pt_z_1

. cf _all using z1

. cf _all using z2

. 
. use z4, clear

. * compare with direct calculations
. assert records==`n' if study==3

. assert subjects==`n' if study==3

. assert failures==`d' if study==3

. * compare with other mvmeta_make commands
. drop records subjects failures

. cf _all using z1

. 
. 
. // WEB DATA REGARDING GENDER AS A STUDY: TEST STUDY NUMERIC/LABELLED/STRING
. webuse mheart1s20, clear
(Fictional heart attack data; BMI missing)

. * get truth
. mi estimate, post: logit attack smokes age if female==1

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =         38
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       1.82
Within VCE type:          OIM                   Prob > F          =     0.1621

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   .8268826   .7085577     1.17   0.243    -.5618649     2.21563
         age |    .036274   .0299098     1.21   0.225    -.0223482    .0948961
       _cons |  -2.709729   1.742389    -1.56   0.120    -6.124748    .7052901
------------------------------------------------------------------------------

. local bage = _b[age]

. * study as numeric
. mvmeta_make, by(female) saving(z1) replace: mi estimate, post: logit attack s
> mokes age
Learning equation names...
Using coefficients: smokes age 


-> female==0

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =        116
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       5.72
Within VCE type:          OIM                   Prob > F          =     0.0033

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   1.245292   .4040347     3.08   0.002     .4533982    2.037185
         age |   .0316429   .0173879     1.82   0.069    -.0024368    .0657226
       _cons |  -2.500837    1.03729    -2.41   0.016    -4.533887   -.4677867
------------------------------------------------------------------------------


-> female==1

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =         38
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       1.82
Within VCE type:          OIM                   Prob > F          =     0.1621

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   .8268826   .7085577     1.17   0.243    -.5618649     2.21563
         age |    .036274   .0299098     1.21   0.225    -.0223482    .0948961
       _cons |  -2.709729   1.742389    -1.56   0.120    -6.124748    .7052901
------------------------------------------------------------------------------

file z1.dta saved

. * study as labelled numeric
. label def female 0 "M" 1 "F"

. label val female female

. mvmeta_make, by(female) saving(z2) replace: mi estimate, post: logit attack s
> mokes age
Learning equation names...
Using coefficients: smokes age 


-> female==M

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =        116
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       5.72
Within VCE type:          OIM                   Prob > F          =     0.0033

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   1.245292   .4040347     3.08   0.002     .4533982    2.037185
         age |   .0316429   .0173879     1.82   0.069    -.0024368    .0657226
       _cons |  -2.500837    1.03729    -2.41   0.016    -4.533887   -.4677867
------------------------------------------------------------------------------


-> female==F

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =         38
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       1.82
Within VCE type:          OIM                   Prob > F          =     0.1621

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   .8268826   .7085577     1.17   0.243    -.5618649     2.21563
         age |    .036274   .0299098     1.21   0.225    -.0223482    .0948961
       _cons |  -2.709729   1.742389    -1.56   0.120    -6.124748    .7052901
------------------------------------------------------------------------------

file z2.dta saved

. * study as string
. decode female, gen(femalechar)

. drop female

. mvmeta_make, by(female) saving(z3) replace: mi estimate, post: logit attack s
> mokes age
Learning equation names...
Using coefficients: smokes age 


-> femalechar==F

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =         38
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       1.82
Within VCE type:          OIM                   Prob > F          =     0.1621

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   .8268826   .7085577     1.17   0.243    -.5618649     2.21563
         age |    .036274   .0299098     1.21   0.225    -.0223482    .0948961
       _cons |  -2.709729   1.742389    -1.56   0.120    -6.124748    .7052901
------------------------------------------------------------------------------


-> femalechar==M

Multiple-imputation estimates                   Imputations       =         20
Logistic regression                             Number of obs     =        116
                                                Average RVI       =     0.0000
                                                Largest FMI       =     0.0000
DF adjustment:   Large sample                   DF:     min       =          .
                                                        avg       =          .
                                                        max       =          .
Model F test:       Equal FMI                   F(   2,      .)   =       5.72
Within VCE type:          OIM                   Prob > F          =     0.0033

------------------------------------------------------------------------------
      attack | Coefficient  Std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      smokes |   1.245292   .4040347     3.08   0.002     .4533982    2.037185
         age |   .0316429   .0173879     1.82   0.069    -.0024368    .0657226
       _cons |  -2.500837    1.03729    -2.41   0.016    -4.533887   -.4677867
------------------------------------------------------------------------------

file z3.dta saved

. * check results
. use z1, clear

. assert reldif(yage,`bage')<1E-7 if female==1

. cf _all using z2

. 
. use z2, clear

. assert reldif(yage,`bage')<1E-7 if female==1

. 
. use z3, clear

. assert reldif(yage,`bage')<1E-7 if female=="F"

. 
. 
. // TIDY UP
. forvalues i=1/5 {
  2.         erase z`i'.dta
  3. }

. erase c:\temp\z.dta

. 
. 
. // REPORT SUCCESS
. di as result _n "********************************************" ///
>         _n "*** MVMETA_MAKE HAS PASSED ALL ITS TESTS ***" ///
>         _n "********************************************"

********************************************
*** MVMETA_MAKE HAS PASSED ALL ITS TESTS ***
********************************************

. 
. 
. log close
      name:  <unnamed>
       log:  c:\ian\git\mvmeta\testlogs\mvmeta_make_cscript.log
  log type:  text
 closed on:  28 Jul 2023, 17:40:33
-------------------------------------------------------------------------------
